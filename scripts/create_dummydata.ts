import "dotenv/config";
import { prisma } from "../src/server/db/client";

/*
1. add 
"type": "module"
 in package.json

 2. 
 yarn tsnode ./scripts/create_dummydata.ts
*/

async function main() {
  //await clear_entire_db();
  //await create_users();
  //const msg = await create_profiles();
  const replayId = await create_replay();
}

async function clear_entire_db() {
  //there has to be a single command right?...
  await prisma.user.deleteMany({});
  await prisma.profile.deleteMany({});
  await prisma.replay.deleteMany({});
  await prisma.replaysOnProfiles.deleteMany({});
  await prisma.replayData.deleteMany({});
}

async function create_users() {
  const data = [
    { name: "allan", email: "some@email.com" },
    { name: "bertil", email: "" },
  ];
  return await prisma.user.createMany({ data });
}

async function create_profiles() {
  const data = [
    { name: "allans-main", bio: "", userId: "cl66v4iw10000cwuiqknyhkx8" },
    { name: "allans-extraalt", bio: "", userId: "cl66v4iw10000cwuiqknyhkx8" },
    { name: "bertil", bio: "", userId: "cl66v4iw10001cwuin1a14mt4" },
  ];
  return await prisma.profile.createMany({ data });
}

async function create_replay() {
  const player1Id = 7; //allan
  const player2Id = 8; //bertil

  const playerIds = [player1Id, player2Id];
  const winnerId = player1Id;
  const replaydata = tenstepreplaydata;
  const info = { turns: 10 }; //some info here...

  const id = await saveReplay(replaydata, playerIds, winnerId, info);
  return id;
}

const tenstepreplaydata = [
  [
    [],
    [
      [0, 2, 0, 640, 0, 0],
      [1, 2, 1, 640, 270, 0],
      [2, 3, 0, 40, 100, 0],
      [3, 5, 1, 160, 250, 0],
      [4, 3, 0, 40, 100, -20],
      [5, 4, 0, 80, 100, -30],
      [6, 6, 0, 320, 40, -10],
    ],
  ],
  [
    [
      [2, 0, 128, 0],
      [2, 1, 1],
      [3, 0, 230.3883864861816, 3.922322702763681],
      [3, 1, 0],
      [4, 0, 127.45625891934577, -14.508748216130847],
      [4, 1, 1],
      [5, 0, 122.98783084530763, -23.10365074640771],
      [5, 1, 1],
      [6, 0, 55.96884125572622, -9.001947421517112],
      [6, 1, 1],
    ],
    [
      [0, 2, 0, 640, 0, 0],
      [1, 2, 1, 629, 270, 0],
      [2, 3, 0, 40, 128, 0],
      [3, 5, 1, 160, 230.3883864861816, 3.922322702763681],
      [4, 3, 0, 40, 127.45625891934577, -14.508748216130847],
      [5, 4, 0, 72, 122.98783084530763, -23.10365074640771],
      [6, 6, 0, 320, 55.96884125572622, -9.001947421517112],
    ],
  ],
  [
    [
      [2, 0, 156, 0],
      [2, 1, 1],
      [3, 0, 210.77677297236318, 7.844645405527362],
      [3, 1, 0],
      [4, 0, 154.91251783869154, -9.017496432261694],
      [4, 1, 1],
      [5, 0, 145.97566169061525, -16.207301492815418],
      [5, 1, 1],
      [6, 0, 71.93768251145244, -8.003894843034224],
      [6, 1, 1],
    ],
    [
      [0, 2, 0, 640, 0, 0],
      [1, 2, 1, 553, 270, 0],
      [2, 3, 0, 36, 156, 0],
      [3, 5, 1, 160, 210.77677297236318, 7.844645405527362],
      [4, 3, 0, 36, 154.91251783869154, -9.017496432261694],
      [5, 4, 0, 64, 145.97566169061525, -16.207301492815418],
      [6, 6, 0, 288, 71.93768251145244, -8.003894843034224],
    ],
  ],
  [
    [
      [2, 0, 184, 0],
      [2, 1, 1],
      [3, 0, 191.16515945854476, 11.766968108291042],
      [3, 1, 0],
      [4, 0, 182.3687767580373, -3.52624464839254],
      [4, 1, 1],
      [5, 0, 168.96349253592288, -9.31095223922313],
      [5, 1, 1],
      [6, 0, 87.90652376717865, -7.005842264551336],
      [6, 1, 1],
    ],
    [
      [0, 2, 0, 640, 0, 0],
      [1, 2, 1, 477, 270, 0],
      [2, 3, 0, 32, 184, 0],
      [3, 5, 1, 160, 191.16515945854476, 11.766968108291042],
      [4, 3, 0, 32, 182.3687767580373, -3.52624464839254],
      [5, 4, 0, 56, 168.96349253592288, -9.31095223922313],
      [6, 6, 0, 256, 87.90652376717865, -7.005842264551336],
    ],
  ],
  [
    [
      [2, 0, 200, 0],
      [2, 1, 1],
      [3, 0, 171.55354594472635, 15.689290811054724],
      [3, 1, 0],
      [4, 0, 200, 0],
      [4, 1, 1],
      [5, 0, 191.9513233812305, -2.414602985630845],
      [5, 1, 1],
      [6, 0, 103.87536502290487, -6.007789686068447],
      [6, 1, 1],
    ],
    [
      [0, 2, 0, 613, 0, 0],
      [1, 2, 1, 401, 270, 0],
      [2, 3, 0, 28, 200, 0],
      [3, 5, 1, 144, 171.55354594472635, 15.689290811054724],
      [4, 3, 0, 28, 200, 0],
      [5, 4, 0, 48, 191.9513233812305, -2.414602985630845],
      [6, 6, 0, 224, 103.87536502290487, -6.007789686068447],
    ],
  ],
  [
    [
      [2, 0, 200, 0],
      [2, 1, 1],
      [3, 0, 151.94193243090794, 19.611613513818405],
      [3, 1, 0],
      [4, 0, 200, 0],
      [4, 1, 1],
      [5, 0, 200, 0],
      [5, 1, 1],
      [6, 0, 119.84420627863109, -5.009737107585559],
      [6, 1, 1],
    ],
    [
      [0, 2, 0, 586, 0, 0],
      [1, 2, 1, 325, 270, 0],
      [2, 3, 0, 24, 200, 0],
      [3, 5, 1, 128, 151.94193243090794, 19.611613513818405],
      [4, 3, 0, 24, 200, 0],
      [5, 4, 0, 40, 200, 0],
      [6, 6, 0, 192, 119.84420627863109, -5.009737107585559],
    ],
  ],
  [
    [
      [2, 0, 200, 0],
      [2, 1, 1],
      [3, 0, 132.33031891708953, 23.533936216582084],
      [3, 1, 0],
      [4, 0, 200, 0],
      [4, 1, 1],
      [5, 0, 200, 0],
      [5, 1, 1],
      [6, 0, 135.8130475343573, -4.01168452910267],
      [6, 1, 1],
    ],
    [
      [0, 2, 0, 559, 0, 0],
      [1, 2, 1, 249, 270, 0],
      [2, 3, 0, 20, 200, 0],
      [3, 5, 1, 112, 132.33031891708953, 23.533936216582084],
      [4, 3, 0, 20, 200, 0],
      [5, 4, 0, 32, 200, 0],
      [6, 6, 0, 160, 135.8130475343573, -4.01168452910267],
    ],
  ],
  [
    [
      [2, 0, 200, 0],
      [2, 1, 1],
      [3, 0, 112.71870540327112, 27.456258919345768],
      [3, 1, 0],
      [4, 0, 200, 0],
      [4, 1, 1],
      [5, 0, 200, 0],
      [5, 1, 1],
      [6, 0, 151.7818887900835, -3.0136319506197813],
      [6, 1, 1],
    ],
    [
      [0, 2, 0, 532, 0, 0],
      [1, 2, 1, 173, 270, 0],
      [2, 3, 0, 16, 200, 0],
      [3, 5, 1, 96, 112.71870540327112, 27.456258919345768],
      [4, 3, 0, 16, 200, 0],
      [5, 4, 0, 24, 200, 0],
      [6, 6, 0, 128, 151.7818887900835, -3.0136319506197813],
    ],
  ],
  [
    [
      [2, 0, 200, 0],
      [2, 1, 1],
      [3, 0, 93.10709188945272, 31.37858162210945],
      [3, 1, 0],
      [4, 0, 200, 0],
      [4, 1, 1],
      [5, 0, 200, 0],
      [5, 1, 1],
      [6, 0, 167.75073004580972, -2.0155793721368926],
      [6, 1, 1],
    ],
    [
      [0, 2, 0, 505, 0, 0],
      [1, 2, 1, 97, 270, 0],
      [2, 3, 0, 12, 200, 0],
      [3, 5, 1, 80, 93.10709188945272, 31.37858162210945],
      [4, 3, 0, 12, 200, 0],
      [5, 4, 0, 16, 200, 0],
      [6, 6, 0, 96, 167.75073004580972, -2.0155793721368926],
    ],
  ],
  [
    [
      [2, 0, 200, 0],
      [2, 1, 1],
      [3, 0, 73.49547837563432, 35.30090432487313],
      [3, 1, 0],
      [4, 0, 200, 0],
      [4, 1, 1],
      [5, 0, 200, 0],
      [5, 1, 1],
      [6, 0, 183.71957130153592, -1.017526793654004],
      [6, 1, 1],
    ],
    [
      [0, 2, 0, 478, 0, 0],
      [1, 2, 1, 21, 270, 0],
      [2, 3, 0, 8, 200, 0],
      [3, 5, 1, 64, 73.49547837563432, 35.30090432487313],
      [4, 3, 0, 8, 200, 0],
      [5, 4, 0, 8, 200, 0],
      [6, 6, 0, 64, 183.71957130153592, -1.017526793654004],
    ],
  ],
  [
    [
      [2, 0, 200, 0],
      [2, 1, 1],
      [3, 0, 53.883864861815916, 39.22322702763681],
      [3, 1, 0],
      [4, 0, 200, 0],
      [4, 1, 1],
      [5, 0, 200, 0],
      [5, 1, 1],
      [6, 0, 199.68841255726213, -0.01947421517111625],
      [6, 1, 1],
    ],
    [
      [0, 2, 0, 451, 0, 0],
      [2, 3, 0, 4, 200, 0],
      [3, 5, 1, 48, 53.883864861815916, 39.22322702763681],
      [4, 3, 0, 4, 200, 0],
      [5, 4, 0, 0, 200, 0],
      [6, 6, 0, 32, 199.68841255726213, -0.01947421517111625],
    ],
  ],
];

/**
 * Save a replay its relation to users.
 *
 * Return the created replay id.
 */
async function saveReplay(
  replaydata: number[][][][],
  playerIds: number[],
  winningProfileId: number,
  replayinfo: Record<string, string | number>,
) {
  //create a replay
  const r = await prisma.replay.create({
    data: {
      winningProfileId: winningProfileId,
      gameLength: replaydata.length,
    },
  });

  //create a replaydata and connect it to replay
  const r2 = await prisma.replayData.create({
    data: {
      data: replaydata,
      replayId: r.id,
    },
  });

  //create multiple replaysOnUsers that relates each user to replay
  const rels = await prisma.replaysOnProfiles.createMany({
    data: playerIds.map((playerId) => ({
      replayId: r.id,
      profileId: playerId,
    })),
  });

  return r.id;
}

main();
